{"version":3,"sources":["webpack-config.js"],"names":["path","require","webpack","babelClientOpts","babelServerOpts","ReactLoadablePlugin","CleanWebpackPlugin","CopyPlugin","nodeExternals","REACT_LOADABLE_MANIFEST","getBaseWebpackConfig","dir","config","target","entrypoints","dev","distDir","join","plugins","output","optimization","libraryTarget","push","patterns","from","__dirname","to","DefinePlugin","__IS_SERVER__","JSON","stringify","BuildEntryPlugin","HotModuleReplacementPlugin","filename","resolve","runtimeChunk","name","entry","externals","publicPath","alias","__root","process","cwd","extensions","node","mode","watch","module","rules","test","exclude","use","loader","options"],"mappings":"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","sourcesContent":["const path = require('path');\nconst webpack = require('webpack');\nconst {babelClientOpts, babelServerOpts} = require('./babel-config');\nconst { ReactLoadablePlugin } = require('react-loadable/webpack');\nconst { CleanWebpackPlugin } = require('clean-webpack-plugin');\nconst CopyPlugin = require('copy-webpack-plugin');\nconst nodeExternals = require('webpack-node-externals');\nimport BuildEntryPlugin from '../webpack/plugins/build-entry-plugin';\nimport HotReloader from './hot-reloader';\nconst { REACT_LOADABLE_MANIFEST } = require('../lib/constants');\n\nexport default async function getBaseWebpackConfig(\n    dir,\n    {\n        config,\n        target = 'server',\n        entrypoints,\n        dev = false\n    }\n) {\n    const distDir = path.join(dir, config.distDir)\n    const plugins = [];\n    const output = {}\n    const optimization = {};\n    if (target === 'server') {\n        output.libraryTarget = 'commonjs2'\n        output.path = path.join(distDir, 'server');\n        plugins.push(new CleanWebpackPlugin())\n        // plugins.push(new PagesManifestPlugin())\n        plugins.push(new CopyPlugin({\n            patterns: [\n                {from: path.join(__dirname, '../server/pages'), to: output.path}\n            ]\n        }))\n        plugins.push(new webpack.DefinePlugin({\n            __IS_SERVER__: JSON.stringify(true)\n        }))\n    } else {\n        output.path = distDir;\n        // output.chunkFilename = '[name].bundle.js';\n        plugins.push(new CleanWebpackPlugin())\n        plugins.push(new BuildEntryPlugin())\n        if (dev) {\n            plugins.push(new webpack.HotModuleReplacementPlugin());\n        }\n        plugins.push(new webpack.DefinePlugin({\n            __IS_SERVER__: JSON.stringify(false)\n        }))\n        plugins.push(new ReactLoadablePlugin({\n            filename: path.resolve(output.path, REACT_LOADABLE_MANIFEST),\n        }));\n        \n        // optimization.splitChunks = {\n        //     maxAsyncRequests: 1,\n        //     cacheGroups: {\n        //         vendor: {\n        //             name: \"vendor\",\n        //             priority: 10,\n        //             enforce: true,\n        //         },\n        //     }\n        // };\n        optimization.runtimeChunk = {\n            name: 'runtime'\n        };\n        if (!dev) {\n        }\n    }\n    \n    \n    \n    return {\n        entry: entrypoints,\n        target: target === 'server' ? 'node' : 'web',\n        externals: target === 'server' ? [nodeExternals()] : [],\n        output: {\n            filename: dev ? '[name].js' : target === 'server' ? '[name].js' : '[name].[chunkhash].js',\n            publicPath: '/dist/',\n            ...output\n        },\n        resolve: {\n            alias: {\n                __root: process.cwd(),\n                'ha/document': path.resolve(__dirname, '../server/pages/_document')\n            },\n            extensions: ['.ts', '.tsx', '.js', '.jsx', '.json'],\n        },\n        node: {\n            __dirname: true\n        },\n        mode: dev ? 'development' : 'production',\n        watch: dev ? true : false,\n        externals: {\n        },\n        module: {\n            rules: [{\n                    test: /\\.jsx?$/,\n                    exclude: [/node_modules/],\n                    use: [\n                        // 'thread-loader',\n                        {\n                            loader: 'babel-loader',\n                            options: target === 'server' ? babelServerOpts : babelClientOpts\n                        },\n                    ]\n                }, {\n                    test: /\\.less/,\n                    use: target === 'server' ? [\n                        // 'thread-loader',\n                        // 'style-loader',\n                        {\n                            loader: 'css-loader'\n                        }, \n                        // 'postcss-loader',\n                        {\n                            loader: 'less-loader',\n                            // options: {\n                                // javascriptEnabled: true\n                            // }\n                        }\n                    ] : [\n                        // 'thread-loader',\n                        'style-loader', \n                        {\n                            loader: 'css-loader'\n                        }, \n                        // 'postcss-loader',\n                        {\n                            loader: 'less-loader',\n                            // options: {\n                                // javascriptEnabled: true\n                            // }\n                        }\n                    ]\n                }, {\n                    test: /\\.(png|jpg|gif|ico)$/,\n                    loader: 'file-loader',\n                    options: {\n                        name: 'img/[name].[hash:7].[ext]'\n                    }\n                }, {\n                    test: /\\.(woff|eot|ttf|woff2|svg)(\\?.*)?$/,\n                    loader: 'file-loader',\n                    options: {\n                        name: 'fonts/[name].[hash:7].[ext]'\n                    }\n                }]\n        },\n        plugins: [\n            ...plugins,\n        ],\n        optimization,\n    }\n}"]}