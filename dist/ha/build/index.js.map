{"version":3,"sources":["index.js"],"names":["build","dir","dev","config","distDir","path","join","entrypoints","promises","mkdir","recursive","clientWebpackConfig","target","client","serverWebpackConfig","server","result","errors","length","Error","warnings","console","log","chalk","yellow","green","error","red","message"],"mappings":"2DAAA,kDACA,oDACA,sBACA,gEAKA,kCACA,uEACA,oCAEA,wF,mFARA;AACA;AACA;AACA;AAIA;AAGe,cAAeA,CAAAA,KAAf,CAAqBC,GAArB,CAA0B,CACvCC,GAAG,CAAG,KADiC,CAA1B,CAEZ,CACC,KAAMC,CAAAA,MAAM,CAAG,oBAAWF,GAAX,CAAf,CACA,KAAMG,CAAAA,OAAO,CAAGC,cAAKC,IAAL,CAAUL,GAAV,CAAeE,MAAM,CAACC,OAAtB,CAAhB,CACA;AAEA;AACA;AACA,KAAMG,CAAAA,WAAW,CAAG,gCAApB,CAGA,KAAMC,cAASC,KAAT,CAAeL,OAAf,CAAwB,CAAEM,SAAS,CAAE,IAAb,CAAxB,CAAN,CACA,GAAI,CACF,KAAMC,CAAAA,mBAAmB,CAAG,KAAM,2BAAqBV,GAArB,CAA0B,CAACE,MAAD,CAASS,MAAM,CAAE,QAAjB,CAA2BL,WAAW,CAAEA,WAAW,CAACM,MAApD,CAA1B,CAAlC,CACA,KAAMC,CAAAA,mBAAmB,CAAG,KAAM,2BAAqBb,GAArB,CAA0B,CAACE,MAAD,CAASS,MAAM,CAAE,QAAjB,CAA2BL,WAAW,CAAEA,WAAW,CAACQ,MAApD,CAA1B,CAAlC,CAEA,GAAIC,CAAAA,MAAM,CAAG,KAAM,0BAAY,CAACL,mBAAD,CAAsBG,mBAAtB,CAAZ,CAAwD,CAAEZ,GAAF,CAAxD,CAAnB,CACAc,MAAM,CAAG,mCAAsBA,MAAtB,CAAT,CACA,GAAIA,MAAM,CAACC,MAAP,CAAcC,MAAd,CAAuB,CAA3B,CAA8B,CAC5B,KAAM,IAAIC,CAAAA,KAAJ,CAAUH,MAAM,CAACC,MAAP,CAAcX,IAAd,CAAmB,MAAnB,CAAV,CAAN,CACD,CACD,GAAIU,MAAM,CAACI,QAAP,CAAgBF,MAAhB,CAAyB,CAA7B,CAAgC,CAC9BG,OAAO,CAACC,GAAR,CAAYC,eAAMC,MAAN,CAAaR,MAAM,CAACI,QAAP,CAAgBd,IAAhB,CAAqB,MAArB,CAAb,CAAZ,EACD,CAEDe,OAAO,CAACC,GAAR,CAAYC,eAAME,KAAN,CAAY,0BAAZ,CAAZ,EACD,CAAC,MAAOC,KAAP,CAAc,CACdL,OAAO,CAACK,KAAR,CAAcH,eAAMI,GAAN,CAAU,sBAAV,CAAd,EACAN,OAAO,CAACC,GAAR,CAAYC,eAAMI,GAAN,CAAUD,KAAK,CAACE,OAAhB,CAAZ,EACD,CAED;AACA;AACA;AACA;AACA;AACA;AACA;AAIH","sourcesContent":["import path from 'path';\nimport chalk from 'chalk';\nimport { promises } from 'fs';\nimport loadConfig from '../server/config';\n// import {\n//     findPagesMapDir,\n//     collectPages\n// } from './utils'\nimport { createEntrypoints } from './entries';\nimport getBaseWebpackConfig from './webpack-config';\nimport { runCompiler } from './compiler';\n// import { SERVER_DIRECTORY, PAGES_MANIFEST, ROUTES_MANIFEST } from '../lib/constants';\nimport formatWebpackMessages from './format-webpack-messages';\n\nexport default async function build(dir, {\n  dev = false\n}) {\n    const config = loadConfig(dir);\n    const distDir = path.join(dir, config.distDir)\n    // const pagesMapDir = findPagesMapDir(dir);\n    \n    // const mappedPages = await collectPages(pagesMapDir, dir);\n    // const entrypoints = createEntrypoints(mappedPages);\n    const entrypoints = createEntrypoints();\n    \n    \n    await promises.mkdir(distDir, { recursive: true })\n    try {\n      const clientWebpackConfig = await getBaseWebpackConfig(dir, {config, target: 'client', entrypoints: entrypoints.client});\n      const serverWebpackConfig = await getBaseWebpackConfig(dir, {config, target: 'server', entrypoints: entrypoints.server});\n      \n      let result = await runCompiler([clientWebpackConfig, serverWebpackConfig], { dev });\n      result = formatWebpackMessages(result);\n      if (result.errors.length > 0) {\n        throw new Error(result.errors.join('\\n\\n'))\n      }\n      if (result.warnings.length > 0) {\n        console.log(chalk.yellow(result.warnings.join('\\n\\n')))\n      }\n      \n      console.log(chalk.green('Compiled successfully.\\n'))\n    } catch (error) {\n      console.error(chalk.red('Failed to compile.\\n'))\n      console.log(chalk.red(error.message))\n    }\n\n    // const routesManifestPath = path.join(distDir, ROUTES_MANIFEST)\n    // await promises.writeFile(\n    //   routesManifestPath,\n    //   JSON.stringify(mappedPages),\n    //   'utf8'\n    // )\n    // const manifestPath = path.join(distDir, SERVER_DIRECTORY, PAGES_MANIFEST)\n\n    \n    \n}"]}