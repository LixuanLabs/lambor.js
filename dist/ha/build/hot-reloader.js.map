{"version":3,"sources":["hot-reloader.js"],"names":["ignored","HotReloader","constructor","multiCompiler","send","action","args","webpackHotMiddleware","publish","data","webpackDevMiddleware","watchOptions","path","log","console","heartbeat","middlewares","hooks","done","tap","stats","run","req","res","parsedUrl","fn","Promise","resolve","reject","err"],"mappings":"4DAAA,oFACA,oF,mFAEA,KAAMA,CAAAA,OAAO,CAAG,CACZ,iBADY,CAEZ,wBAFY,CAAhB,CAKe,KAAMC,CAAAA,WAAY,CAC7BC,WAAW,CAACC,aAAD,CAAgB,MAiC3BC,IAjC2B,CAiCpB,CAACC,MAAD,CAAS,GAAGC,IAAZ,GAAqB,CACxB,KAAKC,oBAAL,CAA0BC,OAA1B,CAAkC,CAAEH,MAAF,CAAUI,IAAI,CAAEH,IAAhB,CAAlC,EACH,CAnC0B,CACvB,KAAMI,CAAAA,oBAAoB,CAAG,kCACzBP,aAAa,CAAC,CAAD,CADY,CAEzB,CACI;AACA;AACAQ,YAAY,CAAE,CAAEX,OAAF,CACd;AAJJ,CAFyB,CAA7B,CAUA,KAAMO,CAAAA,oBAAoB,CAAG,kCACzBJ,aAAa,CAAC,CAAD,CADY,CAEzB,CACIS,IAAI,CAAE,gBADV,CAEIC,GAAG,CAAEC,OAAO,CAACD,GAFjB,CAGIE,SAAS,CAAE,IAHf,CAFyB,CAA7B,CAQA,KAAKL,oBAAL,CAA4BA,oBAA5B,CACA,KAAKH,oBAAL,CAA4BA,oBAA5B,CACA,KAAKS,WAAL,CAAmB,CACfN,oBADe,CAEfH,oBAFe,CAAnB,CAIA;AACA;AACA;AACA;AACAJ,aAAa,CAAC,CAAD,CAAb,CAAiBc,KAAjB,CAAuBC,IAAvB,CAA4BC,GAA5B,CAAgC,sBAAhC,CAAyDC,KAAD,EAAW,CAC/D,KAAKhB,IAAL,CAAU,YAAV,EACH,CAFD,EAGH,CAID,KAAMiB,CAAAA,GAAN,CAAUC,GAAV,CAAeC,GAAf,CAAoBC,SAApB,CAA+B,CAC3B,IAAK,KAAMC,CAAAA,EAAX,GAAiB,MAAKT,WAAtB,CAAmC,CAC/B,KAAM,IAAIU,CAAAA,OAAJ,CAAY,CAACC,OAAD,CAAUC,MAAV,GAAqB,CACnCH,EAAE,CAACH,GAAD,CAAMC,GAAN,CAAYM,GAAD,EAAS,CAClB,GAAIA,GAAJ,CAAS,MAAOD,CAAAA,MAAM,CAACC,GAAD,CAAb,CACTF,OAAO,GACV,CAHC,CAAF,CAIH,CALK,CAAN,CAMH,CACJ,CA9C4B,C","sourcesContent":["import WebpackDevMiddleware from 'webpack-dev-middleware';\nimport WebpackHotMiddleware from 'webpack-hot-middleware';\n\nconst ignored = [\n    /[\\\\/]\\.git[\\\\/]/,\n    /[\\\\/]node_modules[\\\\/]/,\n]\n\nexport default class HotReloader {\n    constructor(multiCompiler) {\n        const webpackDevMiddleware = WebpackDevMiddleware(\n            multiCompiler[0],\n            {\n                // noInfo: true,\n                // logLevel: 'silent',\n                watchOptions: { ignored },\n                // writeToDisk: true,\n            }\n        )\n\n        const webpackHotMiddleware = WebpackHotMiddleware(\n            multiCompiler[0],\n            {\n                path: '/__webpack-hmr',\n                log: console.log,\n                heartbeat: 2500,\n            }\n        )\n        this.webpackDevMiddleware = webpackDevMiddleware\n        this.webpackHotMiddleware = webpackHotMiddleware\n        this.middlewares = [\n            webpackDevMiddleware,\n            webpackHotMiddleware\n        ];\n        // multiCompiler[1].hooks.done.tap('HotReloaderForServer', (stats) => {\n        //     console.log('HotReloaderForServer');\n        //     this.send('reloadPage')\n        // })\n        multiCompiler[0].hooks.done.tap('HotReloaderForClient', (stats) => {\n            this.send('reloadPage')\n        })\n    }\n    send = (action, ...args) => {\n        this.webpackHotMiddleware.publish({ action, data: args })\n    }\n    async run(req, res, parsedUrl) {\n        for (const fn of this.middlewares) {\n            await new Promise((resolve, reject) => {\n                fn(req, res, (err) => {\n                    if (err) return reject(err)\n                    resolve()\n                })\n            })\n        }\n    }\n}"]}