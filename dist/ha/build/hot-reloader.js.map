{"version":3,"sources":["hot-reloader.js"],"names":["ignored","HotReloader","constructor","multiCompiler","send","action","args","webpackHotMiddleware","publish","data","webpackDevMiddleware","watchOptions","compilers","log","console","heartbeat","middlewares","hooks","done","tap","stats","run","req","res","parsedUrl","fn","Promise","resolve","reject","err"],"mappings":"4DAAA,oFACA,oF,mFAEA,KAAMA,CAAAA,OAAO,CAAG,CACZ,iBADY,CAEZ,wBAFY,CAAhB,CAKe,KAAMC,CAAAA,WAAY,CAC7BC,WAAW,CAACC,aAAD,CAAgB,MA6B3BC,IA7B2B,CA6BpB,CAACC,MAAD,CAAS,GAAGC,IAAZ,GAAqB,CACxB,KAAKC,oBAAL,CAA0BC,OAA1B,CAAkC,CAAEH,MAAF,CAAUI,IAAI,CAAEH,IAAhB,CAAlC,EACH,CA/B0B,CACvB,KAAMI,CAAAA,oBAAoB,CAAG,kCACzBP,aADyB,CAEzB,CACIQ,YAAY,CAAE,CAAEX,OAAF,CADlB,CAFyB,CAA7B,CAOA,KAAMO,CAAAA,oBAAoB,CAAG,kCACzBJ,aAAa,CAACS,SAAd,CAAwB,CAAxB,CADyB,CAEzB,CACIC,GAAG,CAAEC,OAAO,CAACD,GADjB,CAEIE,SAAS,CAAE,IAFf,CAFyB,CAA7B,CAOA,KAAKL,oBAAL,CAA4BA,oBAA5B,CACA,KAAKH,oBAAL,CAA4BA,oBAA5B,CACA,KAAKS,WAAL,CAAmB,CACfN,oBADe,CAEfH,oBAFe,CAAnB,CAIA;AACA;AACA;AACA;AACAJ,aAAa,CAACS,SAAd,CAAwB,CAAxB,EAA2BK,KAA3B,CAAiCC,IAAjC,CAAsCC,GAAtC,CAA0C,sBAA1C,CAAmEC,KAAD,EAAW,CACzE,KAAKhB,IAAL,CAAU,YAAV,EACH,CAFD,EAGH,CAID,KAAMiB,CAAAA,GAAN,CAAUC,GAAV,CAAeC,GAAf,CAAoBC,SAApB,CAA+B,CAC3B,IAAK,KAAMC,CAAAA,EAAX,GAAiB,MAAKT,WAAtB,CAAmC,CAC/B,KAAM,IAAIU,CAAAA,OAAJ,CAAY,CAACC,OAAD,CAAUC,MAAV,GAAqB,CACnCH,EAAE,CAACH,GAAD,CAAMC,GAAN,CAAYM,GAAD,EAAS,CAClB,GAAIA,GAAJ,CAAS,MAAOD,CAAAA,MAAM,CAACC,GAAD,CAAb,CACTF,OAAO,GACV,CAHC,CAAF,CAIH,CALK,CAAN,CAMH,CACJ,CA1C4B,C","sourcesContent":["import WebpackDevMiddleware from 'webpack-dev-middleware';\nimport WebpackHotMiddleware from 'webpack-hot-middleware';\n\nconst ignored = [\n    /[\\\\/]\\.git[\\\\/]/,\n    /[\\\\/]node_modules[\\\\/]/,\n]\n\nexport default class HotReloader {\n    constructor(multiCompiler) {\n        const webpackDevMiddleware = WebpackDevMiddleware(\n            multiCompiler,\n            {\n                watchOptions: { ignored },\n            }\n        )\n\n        const webpackHotMiddleware = WebpackHotMiddleware(\n            multiCompiler.compilers[0],\n            {\n                log: console.log,\n                heartbeat: 2500,\n            }\n        )\n        this.webpackDevMiddleware = webpackDevMiddleware\n        this.webpackHotMiddleware = webpackHotMiddleware\n        this.middlewares = [\n            webpackDevMiddleware,\n            webpackHotMiddleware\n        ];\n        // multiCompiler[1].hooks.done.tap('HotReloaderForServer', (stats) => {\n        //     console.log('HotReloaderForServer');\n        //     this.send('reloadPage')\n        // })\n        multiCompiler.compilers[0].hooks.done.tap('HotReloaderForClient', (stats) => {\n            this.send('reloadPage')\n        })\n    }\n    send = (action, ...args) => {\n        this.webpackHotMiddleware.publish({ action, data: args })\n    }\n    async run(req, res, parsedUrl) {\n        for (const fn of this.middlewares) {\n            await new Promise((resolve, reject) => {\n                fn(req, res, (err) => {\n                    if (err) return reject(err)\n                    resolve()\n                })\n            })\n        }\n    }\n}"]}